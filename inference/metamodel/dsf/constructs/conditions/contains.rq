PREFIX : <https://openprovenance.org/ns/facet/dsf#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

# ContainsLabelCondition Evaluation
#
# Simplified: Check if container contains something with the required label
# by looking for assertions on contained entities

CONSTRUCT {
    ?eval rdf:type :ConditionEvaluation ;
          :evaluatesCondition ?condition ;
          :evaluatedOn ?container ;
          :evaluatedInScope ?scope ;
          :evaluationResult "true"^^xsd:boolean .
}
WHERE {
    # Start with conditions
    ?condition rdf:type :ContainsLabelCondition ;
              :requiresContains ?requiredLabel .

    # Use pre-materialized ContainmentAssertions (created by direct.rq and propagate.rq)
    ?containment rdf:type :ContainmentAssertion ;
                :assertedOn ?container ;
                :assertsContains ?requiredLabel ;
                :assertedInScope ?scope .

    # Generate deterministic evaluation URI
    BIND(IRI(CONCAT("urn:eval:contains:",
                    MD5(CONCAT(STR(?condition), ":", STR(?container), ":", STR(?scope)))))
         as ?eval)

    # Check doesn't already exist
    FILTER NOT EXISTS {
        ?eval rdf:type :ConditionEvaluation .
    }
}
